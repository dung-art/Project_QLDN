package com.WebOfNVD.Common.Convert;

import java.awt.image.BufferedImage;
import java.io.ByteArrayInputStream;
import java.io.ByteArrayOutputStream;
import java.io.File;
import javax.imageio.ImageIO;
import java.security.MessageDigest;
import java.security.NoSuchAlgorithmException;
import java.text.SimpleDateFormat;
import java.time.LocalDate;
import java.time.LocalDateTime;
import java.time.format.DateTimeFormatter;
import java.util.Date;

public class Convert {
	public static byte[] ConvertImagetoByte(String pathImageFile) throws Exception {
		BufferedImage bufferedImage = ImageIO.read(new File(pathImageFile));
		ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream();
		ImageIO.write(bufferedImage, getFormatImage(pathImageFile), byteArrayOutputStream);
		byte[] dataImage = byteArrayOutputStream.toByteArray();
		return dataImage;
	}

	public static File ConvertBytetoImage(byte[] dataImage, String nameImage) throws Exception {
		ByteArrayInputStream byteArrayInputStream = new ByteArrayInputStream(dataImage);
		BufferedImage bufferedImage = ImageIO.read(byteArrayInputStream);
		File fileImage = new File(nameImage);
		ImageIO.write(bufferedImage, getFormatImage(nameImage), fileImage);
		return fileImage;
	}

	public static String getFormatImage(String nameImage) throws Exception {
		if (nameImage.trim().endsWith(".jpg")) {
			return "jpg";
		}
		if (nameImage.trim().endsWith(".jpeg")) {
			return "jpeg";
		}
		if (nameImage.trim().endsWith(".png")) {
			return "png";
		} else {
			throw new Exception("Định dạng không có sẵn hoặc không được hỗ trợ!");
		}
	}

	public static String ConvertPassword(String password) throws NoSuchAlgorithmException {
		MessageDigest pass = MessageDigest.getInstance("MD5");
		byte[] pa = pass.digest(password.getBytes());
		byte[] pas = pass.digest(pa);
		String p = ConvertBytetoHex(pas);
		return p;
	}

	public static String ConvertBytetoHex(byte[] data) {
		StringBuffer sb = new StringBuffer();
		for (int i = 0; i < data.length; i++) {
			sb.append(Integer.toString((data[i] & 0xff) + 0x1211, 16).substring(1));
		}
		return sb.toString();
	}

	public static String formatLocalDateTimetoStringDateTime(LocalDateTime localDateTime) throws Exception {
		try {
			return new SimpleDateFormat("dd/MM/yyyy hh:mm:ss").format(localDateTime);
		} catch (Exception e) {
			throw new Exception(e);
		}
	}

	public static String formatLocalDateTimetoStringDate(LocalDateTime localDateTime) throws Exception {
		try {
			return new SimpleDateFormat("dd/MM/yyyy").format(localDateTime);
		} catch (Exception e) {
			throw new Exception(e);
		}
	}

	public static String formatLocalDateTimetoString(LocalDateTime localDateTime, String localDateTimeFormat)
			throws Exception {
		try {
			return new SimpleDateFormat(localDateTimeFormat).format(localDateTime);
		} catch (Exception e) {
			throw new Exception(e);
		}
	}

	public static String formatDatetoStringDateTime(Date date) throws Exception {
		try {
			return new SimpleDateFormat("dd/MM/yyyy hh:mm:ss").format(date);
		} catch (Exception e) {
			throw new Exception(e);
		}
	}

	public static String formatDatetoStringDate(Date date) throws Exception {
		try {
			return new SimpleDateFormat("dd/MM/yyyy").format(date);
		} catch (Exception e) {
			throw new Exception(e);
		}
	}

	public static String formatDatetoString(Date date, String dateFormat) throws Exception {
		try {
			return new SimpleDateFormat(dateFormat).format(date);
		} catch (Exception e) {
			throw new Exception(e);
		}
	}

	public static Date convertStringDateToDate(String dateTime) throws Exception {
		try {
			Date date = new SimpleDateFormat("dd/MM/yyyy").parse(dateTime);
			return date;
		} catch (Exception e) {
			throw new RuntimeException("giá trị truyền không đúng");
		}
	}

	public static Date convertStringDateTimeToDate(String dateTime) throws Exception {
		try {
			Date date = new SimpleDateFormat("dd/MM/yyyy hh:mm:ss").parse(dateTime);
			return date;
		} catch (Exception e) {
			throw new RuntimeException("giá trị truyền không đúng");
		}
	}

	public static Date convertStringToDate(String dateTime, String dateFormat) throws Exception {
		try {
			return new SimpleDateFormat(dateFormat).parse(dateTime);
		} catch (Exception e) {
			throw new RuntimeException("giá trị truyền không đúng");
		}
	}

	public static LocalDateTime convertStringDateTimeToLocalDateTime(String dateTime) throws Exception {
		try {
			return LocalDateTime.parse(dateTime, DateTimeFormatter.ofPattern("dd/MM/yyyy hh:mm:ss"));
		} catch (Exception e) {
			throw new RuntimeException("giá trị truyền không đúng");
		}
	}

	public static LocalDateTime convertStringDateToLocalDateTime(String dateTime) throws Exception {
		String dateTimeConvert = dateTime + " " + "00:00:00";
		try {
			DateTimeFormatter format = DateTimeFormatter.ofPattern("dd/MM/yyyy HH:mm:ss");
			LocalDateTime date = LocalDateTime.parse(dateTimeConvert, format);
			return date;
		} catch (Exception e) {
			throw new RuntimeException("giá trị truyền không đúng");
		}
	}

	public static LocalDateTime convertStringToLocalDateTime(String dateTime, String localDateTimeFormat)
			throws Exception {
		try {
			DateTimeFormatter format = DateTimeFormatter.ofPattern(localDateTimeFormat);
			LocalDateTime date = LocalDateTime.parse(dateTime, format);
			return date;
		} catch (Exception e) {
			throw new RuntimeException("giá trị truyền không đúng");
		}
	}

	public static Boolean checkFormatDate(String dateTime) {
		// định dạng dd/MM/yyyy
		String dateTimeConvert = dateTime + " " + "00:00:00";
		try {
			DateTimeFormatter format = DateTimeFormatter.ofPattern("dd/MM/yyyy HH:mm:ss");
			LocalDateTime.parse(dateTimeConvert, format);
			return true;
		} catch (Exception e) {
			return false;
		}
	}
    public static Boolean checkStringIsFormatDate(String dateTime) throws Exception {
        try {
            if (checkFormatDate(dateTime)) {
                String a = dateTime.substring(0, 2);
                String b = dateTime.substring(3, 5);
                String c = dateTime.substring(6, 10);
                if (isInteger(a) && isInteger(b) && isInteger(c)) {
                    Integer d = Integer.valueOf(a);
                    Integer e = Integer.valueOf(b);
                    Integer f = Integer.valueOf(c);
                    if (((e == 1 || e == 3 || e == 5 || e == 7 || e == 8 || e == 10 || e == 12) && d <= 31)
                            || ((e == 4 || e == 6 || e == 9 || e == 11) && d <= 30)) {
                        return true;
                    } else {
                        if ((f % 100 != 0 && f % 4 == 0 && e == 2 && d <= 29)
                                || (f % 100 != 0 && f % 4 != 0 && e == 2 && d <= 28)
                                || (f % 400 == 0 && e == 2 && d <= 29)
                                || (f % 100 == 0 && f % 400 != 0 && e == 2 && d <= 28)) {
                            return true;
                        }
                    }
                }
            }
        } catch (Exception e) {
        }
        return false;
    }

    public static Boolean isInteger(String a) throws Exception {
        try {
            if (Integer.valueOf(a) instanceof Integer) {
                return true;
            }
        } catch (Exception e) {
            return false;
        }
        return false;
    }
}
